<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body oncontextmenu="return false;">
    <script src="jquery.csv.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/102/three.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.2/TweenMax.min.js"></script>
    <script src="see_molecules.js"></script>
    <h2><u>List of Controls</u><br />
        w = move forward a = move left s = move backward d = move right, r =reset<br />
        right click = rotate camera, <del>left click = rotate object</del>
    </h2>
    
    <button type="button" onclick="load_dataset_1()">Load Dataset 1</button>
    <button type="button" onclick="load_dataset_2()">Load Dataset 2</button>
    <button type="button" onclick="load_dataset_3()">Load Dataset 3</button>
    <button type="button" onclick="load_dataset_4()">Load Dataset 4</button>
    <button type="button" onclick="load_dataset_drift()">Load Drift Dataset</button>
    <h2>
        <span id="title"></span>
    </h2>
    <h2>
        Red molecules are gpi and 40 nm in diameter, Orange molecules are vGlut and 50nm in diameter
    </h2>
    <script>

        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000)
        camera.position.z = 10;

        var renderer = new THREE.WebGLRenderer({andtialias: true});
        renderer.setClearColor("#00000");
        renderer.setSize(window.innerWidth,window.innerHeight);

        document.body.appendChild(renderer.domElement);
        load_dataset_1()
        document.getElementById('title').innerHTML = 'Non-Stimulated Neuron';
        var light = new THREE.PointLight(0xFFFFFF, 1 , 500);
        light.position.set(10,0,25);
        scene.add(light)
        

        var circle_size = 6;

        function load_dataset_1(){
            clear_scene();
            camera_reset();
            document.getElementById('title').innerHTML = 'Non-Stimulated Neuron';
            build_new_scene("1_red.txt",1)
            build_new_scene("1_orange.txt",2)
            scene.add(light);
        }
        function load_dataset_2(){
            clear_scene();
            camera_reset();
            document.getElementById('title').innerHTML = 'Stimulated Neuron';
            build_new_scene("2_red.txt",1)
            build_new_scene("2_orange.txt",2)
            scene.add(light);
        }
        function load_dataset_3(){
            clear_scene();
            camera_reset();
            document.getElementById('title').innerHTML = 'Stimulated Neuron';
            build_new_scene("3_red.txt",1)
            build_new_scene("3_orange.txt",2)
            scene.add(light);
        }
        function load_dataset_4(){
            clear_scene();
            camera_reset();
            document.getElementById('title').innerHTML = 'Stimulated Neuron';
            build_new_scene("4_red.txt",1)
            build_new_scene("4_orange.txt",2)
            scene.add(light);
        }
        function load_dataset_drift(){
            clear_scene();
            camera_reset();
            document.getElementById('title').innerHTML = 'Example of Drift in early sets';
            build_new_scene("drift_red.txt",1)
            build_new_scene("drift_orange.txt",2)
            scene.add(light);
        }
        function clear_scene(){
            while(scene.children.length >0){
            // clear the scene
                scene.remove(scene.children[0]);
            }
        }
        function build_new_scene(stringName,color)
        {
            Text = readTextFile(stringName);
            [x, y, z] = parse_data(Text);
            if (color == 1){
                // Red color
                red_mesh = build_new_geometry(x, y, z,0.02);
                scene.add(red_mesh)
            }else{
                // orange color
                orange_mesh = build_new_geometry(x, y, z,0.025);
                scene.add(orange_mesh)
            }
            
            
            
        }
        function build_new_geometry(x,y,z, radius)
        {// function to build a geomtry and return the mesh
            var final_geometry = new THREE.Geometry();
            
            for (i=0; i<x.length; i++)
            {// loop over all molecules and add them to the geometry
                var geometry = new THREE.SphereGeometry( radius,circle_size,circle_size);
            //var material = new THREE.MeshLambertMaterial({color : 0xFFCC00});
            var mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(x[i], y[i], z[i]);
            mesh.updateMatrix();
            final_geometry.merge(mesh.geometry, mesh.matrix);
            }
            if(radius == 0.025){// 0.025 is radius of a vesicle meaning orange
                var material = new THREE.MeshLambertMaterial({color : 0xc6ff00});
                return new THREE.Mesh(final_geometry, material)
            }else{
                var material = new THREE.MeshLambertMaterial({color : 0xff2b00});
                return new THREE.Mesh(final_geometry, material)
            }
        }
        
        

        renderer.render(scene, camera)
        window.addEventListener('resize', () => {
            renderer.setSize(window.innerWidth,window.innerHeight);
            camera.aspect = window.innerWidth/window.innerHeight;

            camera.updateProjectionMatrix();
        })


        var render = function(){
            requestAnimationFrame(render);
            
            //orange_mesh.rotation.x += 0.01;
            renderer.render(scene, camera);
        }
        render()
        
        function disp(object){
            console.log(object);
        }
        
    </script>
</body>
</html>